alter table product add prodmodel varchar(100);

drop procedure if exists spPVPolarPlot;
drop procedure if exists spPVPolarSummary;

drop table if exists pv_GainSTDHorn;
drop table if exists pv_testfreq;
drop table if exists pv_vdata;
drop table if exists pv_hdata;
drop table if exists pv_cpdata;
drop table if exists pv_vcalculated;
drop table if exists pv_hcalculated;
drop table if exists pv_cpcalculated;
drop table if exists pv_arcalculated;
drop table if exists pv_gt_intermediate;
drop table if exists pv_gt_calculated;
drop table if exists pv_radata;
drop table if exists pv_gmcalculated;

drop table if exists pv_speccalculated;
drop table if exists pv_prodserial;
drop table if exists pv_testdata;

CREATE TABLE pv_testdata (
  Test_id int(11) NOT NULL AUTO_INCREMENT,
  TestName varchar(50) DEFAULT NULL,
  TestDesc varchar(100) DEFAULT NULL,
  Product_id int(11) ,
  TestDate datetime DEFAULT NULL,
  frequnit varchar(5) DEFAULT 'MHz',
  testcenter varchar(100) DEFAULT NULL,
  instruments varchar(100) DEFAULT NULL,
  Calibration varchar(100) DEFAULT NULL,
  testproc varchar(100) DEFAULT NULL,
  testtype varchar(10) DEFAULT NULL,
  rptheader varchar(200) DEFAULT NULL,
  rptfooter varchar(200) DEFAULT NULL,
  inst_slno varchar(100),
  PRIMARY KEY (Test_id)
) ;



alter table pv_testdata add  foreign key (Product_id) references product(Product_id);


CREATE TABLE pv_prodserial (
  Prodserial_id int(11) NOT NULL AUTO_INCREMENT,
  test_id int(11) DEFAULT NULL,
  SerialNo varchar(45) DEFAULT NULL, 
  PRIMARY KEY (Prodserial_id),
  KEY test_id_idx (test_id),
  CONSTRAINT test_id FOREIGN KEY (test_id) REFERENCES pv_testdata (test_id) 
) ;


CREATE TABLE pv_testfreq (
  freq_id int(11) NOT NULL AUTO_INCREMENT,
  test_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (freq_id),
 KEY test_id_pvidx (test_id),
  CONSTRAINT Prodserial_id FOREIGN KEY (test_id) REFERENCES pv_testdata(test_id) 
);

CREATE TABLE pv_vdata (
  VData_id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  Angle decimal(12,2) DEFAULT NULL,
  Amplitude decimal(12,8) DEFAULT NULL,
  datatype varchar(2) ,

  PRIMARY KEY (VData_id),
  KEY Prodserialid_freq_angle_vp (Prodserial_id,Frequency,Angle,Amplitude,datatype),
  CONSTRAINT FK_pvvdata_test FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id)
) ;
CREATE TABLE pv_hdata (
  HData_id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  Angle decimal(12,2) DEFAULT NULL,
  Amplitude decimal(12,8) DEFAULT NULL,
  datatype varchar(2) not null,
  PRIMARY KEY (HData_id),
  KEY Prodserialid_freq_angle_hp (Prodserial_id,Frequency,Angle,Amplitude,datatype),
  CONSTRAINT FK_pvhdata_test FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id)
) ;

CREATE TABLE pv_cpcalculated (
  CPCalculated_Id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id INT(11) NULL ,
  datatype varchar(2) not null ,
  Frequency decimal(40,20) DEFAULT NULL,
  TestDate datetime DEFAULT NULL,
  3Db_BW_BMax_left decimal(40,20) DEFAULT NULL,
  3Db_BW_BMax_right decimal(40,20) DEFAULT NULL,
  3Db_BW_BMax decimal(40,20) DEFAULT NULL,
  3Db_BS_BMax decimal(40,20) DEFAULT NULL,
  3Db_BW_0_left decimal(40,20) DEFAULT NULL,
  3Db_BW_0_right decimal(40,20) DEFAULT NULL,
  3Db_BW_0 decimal(40,20) DEFAULT NULL,
  3Db_BS_0 decimal(40,20) DEFAULT NULL,
  10Db_BW_BMax_left decimal(40,20) DEFAULT NULL,
  10Db_BW_BMax_right decimal(40,20) DEFAULT NULL,
  10Db_BW_BMax decimal(40,20) DEFAULT NULL,
  10Db_BW_0_left decimal(40,20) DEFAULT NULL,
  10Db_BW_0_right decimal(40,20) DEFAULT NULL,
  10Db_BW_0 decimal(40,20) DEFAULT NULL,
  X1 decimal(40,20) DEFAULT NULL,
  Y1 decimal(40,20) DEFAULT NULL,
  Backlobe decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (CPCalculated_Id),
  KEY FK_cpcalculated_pv (Prodserial_id),
  KEY FK_cpcalculated_pv1 (Test_id),
  CONSTRAINT FK_cpcalculated_pv FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id),
  CONSTRAINT FK_cpcalculated_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;
CREATE TABLE pv_arcalculated (
  ARCalculated_Id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id INT(11) NULL ,
  datatype varchar(2) not null ,
  Frequency decimal(40,20) DEFAULT NULL,
  TestDate datetime DEFAULT NULL,
  VP_0 decimal(40,20) DEFAULT NULL,
  HP_0 decimal(40,20) DEFAULT NULL,
  AR_0 decimal(40,20) DEFAULT NULL,
  VP_P45 decimal(40,20) DEFAULT NULL,
  HP_P45 decimal(40,20) DEFAULT NULL,
  AR_P45 decimal(40,20) DEFAULT NULL,
  VP_M45 decimal(40,20) DEFAULT NULL,
  HP_M45 decimal(40,20) DEFAULT NULL,
  AR_M45 decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (ARCalculated_Id),
  KEY FK_arcalculated_pv (Prodserial_id),
  KEY FK_arcalculated_pv1 (Test_id),
  CONSTRAINT FK_arcalculated_pv FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id),
  CONSTRAINT FK_arcalculated_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;
create table pv_GainSTDHorn(
gsh_id int(11) NOT NULL AUTO_INCREMENT,
test_id int(11) not null,
Frequency decimal(40,20) not null,
stdhorn decimal(40,20) not null default 0,
PRIMARY KEY (gsh_id),
  KEY FK_GSH_test_id_pv (test_id),
  CONSTRAINT FK_GSH_test_id_pv FOREIGN KEY (test_id) REFERENCES pv_testdata (test_id)
);




CREATE TABLE pv_gt_intermediate (
  GTIntermediate_Id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id INT(11) NULL ,
  Frequency decimal(40,20) DEFAULT NULL,
  TestDate datetime DEFAULT NULL,
  HP_0 decimal(40,20) DEFAULT NULL,
  VP_0 decimal(40,20) DEFAULT NULL,
  CP_0 decimal(40,20) DEFAULT NULL,
  HP_P45 decimal(40,20) DEFAULT NULL,
  VP_P45 decimal(40,20) DEFAULT NULL,
  CP_P45 decimal(40,20) DEFAULT NULL,
  HP_M45 decimal(40,20) DEFAULT NULL,
  VP_M45 decimal(40,20) DEFAULT NULL,
  CP_M45 decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (GTIntermediate_Id),
  KEY FK_GTIntermediate_pv (Prodserial_id),
  CONSTRAINT FK_GTIntermediate_pv FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id)
) ;


ALTER TABLE pv_gt_intermediate 
ADD CONSTRAINT FK_GTIntermediate_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id);

CREATE TABLE pv_gt_calculated(
  GTcalculated_Id int(11) NOT NULL AUTO_INCREMENT,
  Test_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  TestDate datetime DEFAULT NULL,
  MAX_CP decimal(40,20) DEFAULT NULL,
  MIN_CP decimal(40,20) DEFAULT NULL,
  Window decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (GTcalculated_Id),
  KEY FK_GTCalculated_pv (Test_id),
  CONSTRAINT FK_GTCalculated_pv FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;
  
ALTER TABLE pv_gt_calculated 
CHANGE COLUMN MAX_CP MAX_CP_0 DECIMAL(40,20) NULL DEFAULT NULL ,
CHANGE COLUMN MIN_CP MIN_CP_0 DECIMAL(40,20) NULL DEFAULT NULL ,
CHANGE COLUMN Window Window_0 DECIMAL(40,20) NULL DEFAULT NULL ,
ADD COLUMN MAX_CP_P45 DECIMAL(40,20) NULL,
ADD COLUMN MIN_CP_P45 DECIMAL(40,20) NULL,
ADD COLUMN Window_P45 DECIMAL(40,20) NULL,
ADD COLUMN MAX_CP_M45 DECIMAL(40,20) NULL,
ADD COLUMN MIN_CP_M45 DECIMAL(40,20) NULL,
ADD COLUMN Window_M45 DECIMAL(40,20) NULL;

CREATE TABLE pv_radata (
  raData_id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  RecvdAmp decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (raData_id),
  KEY Prodserialid_freq_ra (Prodserial_id,Frequency),
  CONSTRAINT FK_pvradata FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id)
) ;

CREATE TABLE pv_gmcalculated (
  GMCalculated_Id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  TestDate datetime DEFAULT NULL,
  gm_A decimal(40,20) DEFAULT NULL,
  gm_B decimal(40,20) DEFAULT NULL,
  gm_C decimal(40,20) DEFAULT NULL,
  gm_D decimal(40,20) DEFAULT NULL,
  gm_Gv decimal(40,20) DEFAULT NULL,
  gm_X decimal(40,20) DEFAULT NULL,
  gm_Y decimal(40,20) DEFAULT NULL,
  gm_GF decimal(40,20) DEFAULT NULL,
  gm_CPGAIN decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (GMCalculated_Id),
  KEY FK_gmcalculated_pv (Prodserial_id),
  KEY FK_gmCalculated_pv1 (Test_id),
  CONSTRAINT FK_gmcalculated_pv FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id),
  CONSTRAINT FK_gmCalculated_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;
CREATE TABLE pv_cpdata (
  CPData_id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id int(11) DEFAULT NULL,
  Frequency decimal(40,20) DEFAULT NULL,
  Angle decimal(12,2) DEFAULT NULL,
  Amplitude decimal(12,8) DEFAULT NULL,
  datatype varchar(2) not null,
  PRIMARY KEY (CPData_id),
  KEY Prodserialid_freq_angle_cp (Prodserial_id,Frequency,Angle,Amplitude,datatype),
  KEY FK_cpdata_pv1 (Test_id),
  CONSTRAINT FK_pvcpdata_test FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id),
   CONSTRAINT FK_pvcpdata_test_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;

CREATE TABLE pv_speccalculated (
  SpecCalculated_Id int(11) NOT NULL AUTO_INCREMENT,
  Prodserial_id int(11) DEFAULT NULL,
  Test_id INT(11) NULL ,
  datatype varchar(2) not null ,
  TestDate datetime DEFAULT NULL,
  3dbBW_BM_spec decimal(40,20) DEFAULT NULL,
  3dbBW_0_spec decimal(40,20) DEFAULT NULL,
  10dbBW_BM_majorspec decimal(40,20) DEFAULT NULL,
  10dbBW_BM_minorspec decimal(40,20) DEFAULT NULL,
  10dbBW_0_majorspec decimal(40,20) DEFAULT NULL,
  10dbBW_0_minorspec decimal(40,20) DEFAULT NULL,
  3dbBS_BM_majorspec decimal(40,20) DEFAULT NULL,
  3dbBS_BM_minorspec decimal(40,20) DEFAULT NULL,
  3dbBS_0_majorspec decimal(40,20) DEFAULT NULL,
  3dbBS_0_minorspec decimal(40,20) DEFAULT NULL,
  PRIMARY KEY (SpecCalculated_Id),
  KEY FK_SpecCalculated_pv (Prodserial_id),
  KEY FK_SpecCalculated_pv1 (Test_id),
  CONSTRAINT FK_SpecCalculated_pv FOREIGN KEY (Prodserial_id) REFERENCES pv_prodserial (Prodserial_id),
  CONSTRAINT FK_SpecCalculated_pv1 FOREIGN KEY (Test_id) REFERENCES pv_testdata (Test_id)
) ;